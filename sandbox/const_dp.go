package main

import (
    "fmt"
    "simplex/dp"
    "simplex/struct/rtree"
    . "simplex/geom"
    . "simplex/constdp"
    . "simplex/relations"
    "strings"
)

func main() {
    var data = []*Point{
        {10, 150}, {35, 165}, {55, 170}, {95, 195}, {130, 190}, {160, 160},
        {185, 155}, {210, 170}, {230, 210}, {195, 265}, {150, 260}, {130, 290},
        {170, 280}, {210, 285}, {250, 270},
    }

    var opts = &dp.Options{Polyline: data, Threshold: 0}

    opts.Relations = get_relations(1.0)
    opts.AvoidSelfIntersection = true
    opts.PreserveComplex = true

    opts.Db = get_db(1)

    var tree = NewConstDP(opts, true)

    var o = NewLineString(tree.Coordinates())
    fmt.Println(o.String())

    opts.Threshold = 25.0
    o = NewLineString(tree.Simplify(opts).At())

    fmt.Println(o.String())
}

func get_db(state int) *rtree.RTree {
    db := NewConstDB()
    var _consts = `
    POLYGON ((86.87842049450202 169.25286124909263, 93.87508288217853 176.83257883574217, 106.70229725958546 171.5850820449848, 116.03118044315414 170.41897164703872, 101.16327286934157 159.63245046603743, 86.87842049450202 156.42564687168567, 86.87842049450202 169.25286124909263))
    POLYGON ((166.4654551543231 195.1988176033933, 155.97046157280835 180.33091002958074, 180.75030752916265 179.45632723112118, 191.24530111067745 188.49368281520333, 188.62155271529875 199.57173159569115, 174.62822793994573 184.12076882290552, 166.4654551543231 195.1988176033933))
    POLYGON ((189.20460791427135 235.1380987330466, 191.53682871016352 245.63309231456137, 200.57418429424567 240.09406792431747, 211.36070547524696 222.6024119551262, 189.20460791427135 235.1380987330466))
    POLYGON ((208.6127218038481 281.81730532027893, 208.62470206190213 282.3444366746558, 209.55916219011567 282.3444366746558, 209.58312270622372 281.7813645461169, 209.0320308357388 281.4938383528204, 208.6127218038481 281.81730532027893))
    POLYGON ((165.92331871103173 154.71077363474566, 166.13617015646457 157.31820384129804, 169.1160903925244 156.7860752277159, 169.38215469931546 164.39551440194015, 171.8299463217932 164.1826629565073, 171.77673346043497 156.46679805956666, 170.18034761968863 153.96579357573071, 165.92331871103173 154.71077363474566 ))
    `

    if state > 0 {
        LoadConstDBFromFile(db, strings.NewReader(_consts))
    }
    return db
}

func get_relations(dist float64) []Relations {
    return []Relations{
        NewGeometryRelate(),
        NewQuadRelate(),
        NewMinDistanceRelate(dist),
    }
}
